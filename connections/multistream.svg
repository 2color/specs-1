<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="516px" preserveAspectRatio="none" style="width:434px;height:516px;" version="1.1" viewBox="0 0 434 516" width="434px" zoomAndPan="magnify"><defs><filter height="300%" id="fzvim38ub738w" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fzvim38ub738w)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="375" x="19" y="350.9727"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="375" x="19" y="397.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="52" x2="52" y1="51.4883" y2="458.8594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="354" x2="354" y1="51.4883" y2="458.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="29" y="48.5352">Dialer</text><ellipse cx="52" cy="19" fill="#FEFECE" filter="url(#fzvim38ub738w)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="40" x2="64" y1="33" y2="33"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="29" y="471.3945">Dialer</text><ellipse cx="52" cy="490.3477" fill="#FEFECE" filter="url(#fzvim38ub738w)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="40" x2="64" y1="504.3477" y2="504.3477"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="324" y="48.5352">Listener</text><ellipse cx="354" cy="19" fill="#FEFECE" filter="url(#fzvim38ub738w)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="342" x2="366" y1="33" y2="33"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="324" y="471.3945">Listener</text><ellipse cx="354" cy="490.3477" fill="#FEFECE" filter="url(#fzvim38ub738w)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="342" x2="366" y1="504.3477" y2="504.3477"/><polygon fill="#A80036" points="342,78.7988,352,82.7988,342,86.7988,346,82.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="348" y1="82.7988" y2="82.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="59" y="78.0566">Open connection</text><rect fill="#EEEEEE" filter="url(#fzvim38ub738w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="419" x="3" y="111.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="422" y1="111.4541" y2="111.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="422" y1="114.4541" y2="114.4541"/><rect fill="#EEEEEE" filter="url(#fzvim38ub738w)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="374" x="25.5" y="100.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="356" x="31.5" y="117.3672">Establish that both sides support multistream-select</text><path d="M8,139.1094 L8,164.1094 L394,164.1094 L394,149.1094 L384,139.1094 L8,139.1094 " fill="#FBFB77" filter="url(#fzvim38ub738w)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M384,139.1094 L384,149.1094 L394,149.1094 L384,139.1094 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="14" y="156.6777">Both sides may send initial multistream id simultaneously</text><polygon fill="#A80036" points="63,190.7305,53,194.7305,63,198.7305,59,194.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="353" y1="194.7305" y2="194.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="69" y="189.9883">Send multistream protocol id</text><polygon fill="#A80036" points="342,220.041,352,224.041,342,228.041,346,224.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="348" y1="224.041" y2="224.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="59" y="219.2988">Send multistream protocol id</text><path d="M18,237.041 L18,262.041 L384,262.041 L384,247.041 L374,237.041 L18,237.041 " fill="#FBFB77" filter="url(#fzvim38ub738w)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M374,237.041 L374,247.041 L384,247.041 L374,237.041 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="24" y="254.6094">If anything other than multistream id is received, abort</text><rect fill="#EEEEEE" filter="url(#fzvim38ub738w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="419" x="3" y="292.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="422" y1="292.0068" y2="292.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="422" y1="295.0068" y2="295.0068"/><rect fill="#EEEEEE" filter="url(#fzvim38ub738w)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="187" x="119" y="281.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="125" y="297.9199">Negotiate protocol to use</text><polygon fill="#A80036" points="342,331.9727,352,335.9727,342,339.9727,346,335.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="348" y1="335.9727" y2="335.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="59" y="331.2305">Send protocol id for desired protocol</text><path d="M19,350.9727 L81,350.9727 L81,357.9727 L71,367.9727 L19,367.9727 L19,350.9727 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="375" x="19" y="350.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="34" y="364.541">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="96" y="363.6074">[protocol is supported by Listener]</text><polygon fill="#A80036" points="63,385.5938,53,389.5938,63,393.5938,59,389.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="353" y1="389.5938" y2="389.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="69" y="384.8516">Echo back protocol id to indicate agreement</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="19" x2="394" y1="398.5938" y2="398.5938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="24" y="409.2285">[protocol is not supported]</text><polygon fill="#A80036" points="63,429.8594,53,433.8594,63,437.8594,59,433.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="353" y1="433.8594" y2="433.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="69" y="429.1172">Send "na" (not available)</text><!--
@startuml

entity Dialer
entity Listener
Dialer -> Listener: Open connection

== Establish that both sides support multistream-select ==

note over Dialer, Listener: Both sides may send initial multistream id simultaneously
Listener -> Dialer: Send multistream protocol id
Dialer -> Listener: Send multistream protocol id
note over Dialer, Listener: If anything other than multistream id is received, abort


== Negotiate protocol to use ==
Dialer -> Listener: Send protocol id for desired protocol

alt protocol is supported by Listener
  Listener -> Dialer: Echo back protocol id to indicate agreement
else protocol is not supported
  Listener -> Dialer: Send "na" (not available)
end

@enduml

PlantUML version 1.2019.05(Sat Apr 20 12:45:36 EDT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_201-b09
Operating System: Mac OS X
OS Version: 10.14.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>